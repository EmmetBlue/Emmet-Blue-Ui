angular.module("EmmetBlue").controller("pharmacyDispensationPrescriptionRequestsController",function(e,t){var n=function(e){var t="manage('view', "+e.RequestID+")",n="manage('dispense', "+e.RequestID+")";console.log(JSON.stringify);var a="data-option-id='"+e.RequestID+"' data-option-request='"+JSON.stringify(e.Request)+"' data-option-patient='"+e.patientInfo.patientfullname+"' data-option-patient-id='"+e.patientInfo.patientid+"'",i="<button class='btn btn-info no-border pharmacy-ack-btn' ng-click=\""+t+'" '+a+"><i class='icon-eye'></i> View </button>",o="<button class='btn btn-danger no-border pharmacy-ack-btn' ng-click=\""+n+'" '+a+">Dispense Items </button>",r="<div class='btn-group'>"+i+o+"</button>";return r};e.dtInstance={},e.dtOptions=t.DT.optionsBuilder.fromFnPromise(function(){var e=t.serverRequest("/pharmacy/pharmacy-request/view","GET");return e}).withPaginationType("full_numbers").withDisplayLength(10).withFixedHeader().withOption("createdRow",function(n){t.compile(angular.element(n).contents())(e)}).withOption("headerCallback",function(n){e.headerCompiled||(e.headerCompiled=!0,t.compile(angular.element(n).contents())(e))}).withButtons([{text:'<i class="icon-printer"></i> <u>V</u>erify HMO Proceed Status',action:function(){$("#verifyHmoProceed").modal("show")},key:{key:"v",ctrlKey:!0,altKey:!0}},{extend:"print",text:'<i class="icon-printer"></i> <u>P</u>rint this data page',key:{key:"p",ctrlKey:!1,altKey:!0}},{extend:"copy",text:'<i class="icon-copy"></i> <u>C</u>opy this data',key:{key:"c",ctrlKey:!1,altKey:!0}}]),e.dtColumns=[t.DT.columnBuilder.newColumn("patientInfo.patientuuid").withTitle("Patient Number"),t.DT.columnBuilder.newColumn(null).withTitle("Patient Type").renderWith(function(e){return e.patientInfo.patienttypename+" ("+e.patientInfo.categoryname+")"}),t.DT.columnBuilder.newColumn("RequestedBy").withTitle("Dispensation Request Sent By"),t.DT.columnBuilder.newColumn("RequestDate").withTitle("Requested Date &amp; Time"),t.DT.columnBuilder.newColumn(null).withTitle("Action").renderWith(n).notSortable()],e.reloadDispensationsTable=function(){e.dtInstance.reloadData()},e.currentRequest={},e.manage=function(t,n){switch(t){case"view":var a=$(".pharmacy-ack-btn[data-option-id='"+n+"'").attr("data-option-patient"),i=$(".pharmacy-ack-btn[data-option-id='"+n+"'").attr("data-option-request");$("#ack_modal").modal("show"),e.currentRequest.Request=$.parseJSON(i),e.currentRequest.PatientName=a;break;case"dispense":var a=$(".pharmacy-ack-btn[data-option-id='"+n+"'").attr("data-option-patient"),i=$(".pharmacy-ack-btn[data-option-id='"+n+"'").attr("data-option-request");e.currentRequest.Request=$.parseJSON(i),e.currentRequest.PatientName=a,e.currentRequest.PatientID=$(".pharmacy-ack-btn[data-option-id='"+n+"'").attr("data-option-patient-id"),$("#new_dispensation").modal({backdrop:"static"})}},e.hmoVerifier=function(){var n={items:e.currentRequest.Request,patient:e.currentRequest.PatientID,requestBy:t.userSession.getID()},a=t.serverRequest("/accounts-biller/hmo-sales-verification/new","POST",n);a.then(function(){$("#ack_modal").modal("hide"),t.alert("Request Sent Successfully","This patient's HMO has been notified successfully. Please refer him/her to their respective departments","success")},function(e){t.errorHandler(e)})},e.getHmoProceedStatus=function(e){var n=t.serverRequest("/accounts-biller/hmo-sales-verification/get-status?uuid="+e+"&department=1","GET");n.then(function(e){console.log("undefined"!=typeof e[0].ProceedStatus,0!=e[0].ProceedStatus,e[0].ProceedStatus),"undefined"!=typeof e[0].ProceedStatus&&0!=e[0].ProceedStatus&&null!=e[0].ProceedStatus?t.alert("Verification successful","Proceed status confirmed","success"):null==e[0].ProceedStatus?t.alert("Request unconfirmed","The specified request has not been processed, please refer patient to HMO","warning"):t.alert("Verification Denied","The specified has been denied, please refer patient to HMO","error"),$("#verifyHmoProceed").modal("hide")},function(e){t.errorHandler(e)})}});