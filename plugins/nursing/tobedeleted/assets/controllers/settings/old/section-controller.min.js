angular.module("EmmetBlue").controller("sectionController",function(e,t,n,a){e.startWatching=!1,e.$watch(function(){return t.storage.sectionManagementData},function(t){e.wardName=t.name,e.wardId=t.id,e.startWatching?e.sectionDtInstance.reloadData():e.startWatching=!0});var o={actionsMarkup:function(e,t,n){var a="functions.manageSection.editSection("+n.WardSectionID+")",o="functions.manageSection.deleteSection("+n.WardSectionID+")",i="functions.manageSection.bedManagement("+n.WardSectionID+")",c="data-option-id='"+n.WardSectionID+"' data-option-section-name='"+n.WardSectionName+"' data-option-section-desc='"+n.WardSectionDescription+"' data-option-section-ward-id='"+n.WardID+"' data-option-section-ward-name='"+n.WardName+"' ",s="<button class='btn btn-default' ng-click=\""+a+'" '+c+"><i class='icon-pencil5'></i> Edit</button>",r="<button class='btn btn-default' ng-click=\""+o+'"'+c+"><i class='icon-bin'></i> Delete</button>",d="<button class='btn btn-default' ng-click=\""+i+'"'+c+"><i icon-bed></i> Manage Beds</button>",s="<button class='btn btn-default' ng-click=\""+a+'" '+c+"><i class='icon-pencil5'></i> </button>",r="<button class='btn btn-default' ng-click=\""+o+'"'+c+"><i class='icon-bin'></i> </button>",d="<button class='btn btn-default' ng-click=\""+i+'"'+c+"><i icon-bed></i> Manage Beds</button>";return"<div class='btn-group'>"+s+r+d+"</div>"},manageSection:{newSection:function(){$("#new-section").modal("show")},newSectionCreated:function(){t.alert("Operation Succesful","New Ward Created","success","notify"),e.newSection={},e.sectionDtInstance.reloadData(),$("#new-section").modal("hide")},editSection:function(t){var n=$(".btn[data-option-id='"+t+"']").attr("data-option-section-name"),a=$(".btn[data-option-id='"+t+"']").attr("data-option-section-desc"),o=$(".btn[data-option-id='"+t+"']").attr("data-option-section-ward-id"),i=$(".btn[data-option-id='"+t+"']").attr("data-option-section-ward-name");e.temp={id:t,sectionName:n,sectionDescription:a,wardId:o,wardName:i},$("#edit-section").modal("show")},sectionEdited:function(){t.alert("Operation Successful","Your changes have been saved successfully","success","notify"),e.tempHolder={},e.sectionDtInstance.reloadData(),$("#edit-section").modal("hide")},sectionDeleted:function(){t.alert("Operation Successful","The selected ward has been deleted successfully","success","notify"),e.tempHolder={},delete e._id,e.sectionDtInstance.reloadData()},deleteSection:function(n){var a="Delete Prompt",i="You are about to delete this Section named "+$(".btn[data-option-id='"+n+"']").attr("data-option-section-name")+". Do you want to continue? Please note that this action cannot be undone",c=!0;e._id=n;var s=function(){var n=t.serverRequest("/nursing/ward-section/delete?"+t.serializeParams({resourceId:e._id}),"DELETE");n.then(function(){o.manageSection.sectionDeleted()},function(e){t.errorHandler(e)})},r="warning",d="Delete";t.confirm(a,i,c,s,r,d)},bedManagement:function(e){var n={name:$(".btn[data-option-id='"+e+"']").attr("data-option-section-name"),id:e};t.storage.bedManagementData=n,$("#bed-management").modal("show")}},loadWard:function(){wards=t.serverRequest("/nursing/ward/view","GET"),wards.then(function(t){e.sectionWards=t},function(e){t.errorHandler(e)})}};o.loadWard(),e.sectionDtInstance={},e.sectionDtOptions=n.fromFnPromise(function(){var n=t.serverRequest("/nursing/ward-section/view?resourceId="+e.wardId,"GET");return n}).withOption("createdRow",function(n){t.compile(angular.element(n).contents())(e)}).withOption("headerCallback",function(n){e.headerCompiled||(e.headerCompiled=!0,t.compile(angular.element(n).contents())(e))}).withButtons([{text:'<i class="icon-file-plus"></i> <u>N</u>ew  Section',action:function(){o.manageSection.newSection()},key:{key:"n",ctrlKey:!0,altKey:!0}},{extend:"print",text:'<i class="icon-printer"></i> <u>P</u>rint this data page',key:{key:"p",ctrlKey:!0,altKey:!0}},{extend:"copy",text:'<i class="icon-copy"></i> <u>C</u>opy this data',key:{key:"c",ctrlKey:!0}}]),e.sectionDtColumns=[a.newColumn("WardSectionID").withTitle("Section ID"),a.newColumn("WardSectionName").withTitle("Section Name"),a.newColumn("WardSectionDescription").withTitle("Section Description"),a.newColumn("CreatedDate").withTitle("Date Created"),a.newColumn(null).withTitle("Action").notSortable().renderWith(o.actionsMarkup)],e.saveNewSection=function(){var n=e.sectionRegistration;n.wardId=e.wardId,$(".loader").addClass("show"),ward=t.serverRequest("/nursing/ward-section/new","post",n),ward.then(function(){$(".loader").removeClass("show"),o.manageSection.newSectionCreated()},function(e){$(".loader").removeClass("show"),t.errorHandler(e)})},e.saveEditSection=function(){var n={resourceId:e.temp.id,WardID:e.temp.wardId,WardSectionName:e.temp.sectionName,WardSectionDescription:e.temp.sectionDescription};$(".loader").addClass("show");var a=t.serverRequest("/nursing/ward-section/edit","PUT",n);a.then(function(){$(".loader").removeClass("show"),o.manageSection.sectionEdited()},function(e){$(".loader").removeClass("show"),t.errorHandler(e)})},e.functions=o});