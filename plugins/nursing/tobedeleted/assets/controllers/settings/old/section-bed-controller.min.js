angular.module("EmmetBlue").controller("sectionBedController",function(e,t){e.startWatching=!1,e.$watch(function(){return t.storage.bedManagementData},function(t){e.sectionName=t.name,e.sectionId=t.id,e.startWatching?e.reloadSectionBedTable():e.startWatching=!0});var n={actionMarkUps:{bedActionMarkUp:function(e){editButtonAction="manageSectionBed('edit',"+e.SectionBedID+")",deleteButtonAction="manageSectionBed('delete',"+e.SectionBedID+")";var t="data-option-id='"+e.SectionBedID+"' data-option-bed-name='"+e.BedName+"' data-option-bed-description='"+e.BedDescription+"'";return editButton="<button class='btn btn-default' ng-click=\""+editButtonAction+'" '+t+"> <i class='fa fa-pencil'></i></button>",deleteButton="<button class='btn btn-default' ng-click=\""+deleteButtonAction+'" '+t+"> <i class='fa fa-trash-o'></i></button>",viewButton="<button class='btn btn-default'><i class='fa fa-eye'></i> </button>","<button class='btn-group'>"+viewButton+editButton+deleteButton+"</button>"}},newBedCreated:function(){t.alert("Operation Successful","You have successfully created a new bed","success","notify"),e.newBed={},e.reloadSectionBedTable(),$("#new_bed").modal("hide")},bedDeleted:function(){t.alert("Operation Successful","The selected bed has been deleted successfully","success","notify"),delete e._id,e.reloadSectionBedTable()},bedEdited:function(){t.alert("Operation Successful","Your changes have been saved successfully","success","notify"),e.tempHolder={},e.reloadSectionBedTable(),$("#edit_bed").modal("hide")},manageBed:{editBed:function(t){var n=$(".btn[data-option-id='"+t+"']").attr("data-option-bed-name"),o=$(".btn[data-option-id='"+t+"']").attr("data-option-bed-description");e.temp={id:t,bedName:n,bedDescription:o},console.log(n),$("#edit_bed").modal("show")},newBed:function(){$("#new_bed").modal("show")},deleteBed:function(o){var a="Delete Prompt",d="You are about to delete the Bed named "+$(".btn[data-option-id='"+o+"']").attr("data-option-bed-name")+". Do you want to continue? Please note that this action cannot be undone",i=!0;e._id=o;var r=function(){var o=t.serverRequest("/nursing/section-bed/delete?"+t.serializeParams({resourceId:e._id}),"DELETE");o.then(function(){n.bedDeleted()},function(e){t.errorHandler(e)})},c="warning",s="Delete";t.confirm(a,d,i,r,c,s)}}};e.ddtInstance={},e.ddtOptions=t.DT.optionsBuilder.fromFnPromise(function(){var n=t.serverRequest("/nursing/section-bed/view-section-bed?resourceId="+e.sectionId,"GET");return n}).withPaginationType("full_numbers").withDisplayLength(10).withFixedHeader().withOption("createdRow",function(n){t.compile(angular.element(n).contents())(e)}).withOption("headerCallback",function(n){e.headerCompiled||(e.headerCompiled=!0,t.compile(angular.element(n).contents())(e))}).withButtons([{text:'<i class="icon-file-plus"></i> New Bed',action:function(){n.manageBed.newBed()}}]),e.ddtColumns=[t.DT.columnBuilder.newColumn("SectionBedID").withTitle("ID").withOption("width","0.5%").notSortable(),t.DT.columnBuilder.newColumn("BedName").withTitle("Bed Name"),t.DT.columnBuilder.newColumn("BedDescription").withTitle("Bed Description"),t.DT.columnBuilder.newColumn(null).withTitle("Action").renderWith(n.actionMarkUps.bedActionMarkUp).notSortable()],e.reloadSectionBedTable=function(){e.ddtInstance.reloadData()},e.saveNewBed=function(){var o=e.newBed;o.wardSectionId=e.sectionId,$(".loader").addClass("show");var a=t.serverRequest("/nursing/section-bed/new","POST",o);a.then(function(){$(".loader").removeClass("show"),n.newBedCreated()},function(e){$(".loader").removeClass("show"),errorHandler(e)})},e.manageSectionBed=function(e,t){switch(e.toLowerCase()){case"edit":n.manageBed.editBed(t);break;case"delete":n.manageBed.deleteBed(t);break;case"role-management":n.manageRole.roleManagement(t)}},e.saveEditBed=function(){var o={resourceId:e.temp.id,BedName:e.temp.bedName,BedDescription:e.temp.bedDescription};$(".loader").addClass("show");var a=t.serverRequest("/nursing/section-bed/edit","PUT",o);a.then(function(){$(".loader").removeClass("show"),n.bedEdited()},function(e){$(".loader").removeClass("show"),t.errorHandler(e)})}});