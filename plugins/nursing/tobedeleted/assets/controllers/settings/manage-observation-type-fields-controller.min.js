angular.module("EmmetBlue").controller("nursingSettingManageObservationTypeFieldsController",function(e,t){function n(e){editButtonAction="manage('edit',"+e.FieldID+")",deleteButtonAction="manage('delete',"+e.FieldID+")";var t="manage('defaults', "+e.FieldID+")",n="manage('dirtyValues', "+e.FieldID+")",i="data-option-id='"+e.FieldID+"' data-option-name='"+e.FieldName+"' data-option-description='"+e.FieldDescription+"'";return editButton="<button class='btn btn-default btn-fields' ng-click=\""+editButtonAction+'" '+i+"> <i class='fa fa-pencil'></i></button>",deleteButton="<button class='btn btn-default btn-fields' ng-click=\""+deleteButtonAction+'" '+i+"> <i class='fa fa-trash-o'></i></button>",fieldsButton="<button class='btn btn-default' ng-click=\""+t+'" '+i+"><i class='icon-eye'> </i> Default Values</button>",dirtButton="<button class='btn btn-default' ng-click=\""+n+'" '+i+"> Dirty Values</button>","<div class='btn-group'>"+fieldsButton+dirtButton+editButton+deleteButton+"</div>"}function i(){"function"==typeof e.dtInstance.reloadData&&e.dtInstance.reloadData()}function r(){var n=t.serverRequest("/nursing/observation-type/view","GET");n.then(function(t){e.observationTypes=t},function(e){t.errorHandler(e)})}function o(){var n=t.serverRequest("/nursing/observation-type-field/view-types","GET");n.then(function(t){e.fieldTypes=t},function(e){t.errorHandler(e)})}e.dtInstance={},e.dtOptions=t.DT.optionsBuilder.fromFnPromise(function(){return t.serverRequest("/nursing/observation-type-field/view?resourceId="+e.currentObservationType,"GET")}).withPaginationType("full_numbers").withDisplayLength(10).withFixedHeader().withOption("createdRow",function(n){t.compile(angular.element(n).contents())(e)}).withOption("headerCallback",function(n){e.headerCompiled||(e.headerCompiled=!0,t.compile(angular.element(n).contents())(e))}).withButtons([{text:'<i class="icon-file-plus"></i> New Field',action:function(){$("#new_setting_observation_type_field").modal("show")}}]),e.dtColumns=[t.DT.columnBuilder.newColumn("FieldID").withTitle("ID"),t.DT.columnBuilder.newColumn("FieldName").withTitle("Field Name"),t.DT.columnBuilder.newColumn("FieldDescription").withTitle("Field Description"),t.DT.columnBuilder.newColumn(null).withTitle("Action").renderWith(n).notSortable()],r(),o(),e.$watch("currentObservationType",function(){i()}),e.saveNewObservationTypeField=function(){var n=e.newObservationTypeField;n.observationType=e.currentObservationType;var r=t.serverRequest("/nursing/observation-type-field/new","POST",n);r.then(function(){$("#new_setting_observation_type_field").modal("hide"),i(),t.notify("Operation Successful","New Field Created Successfully","success"),e.newObservationTypeField={}})},e.saveEditObservationTypeField=function(){var n=t.serverRequest("/nursing/observation-type-field/edit","PUT",e.tempHolder);n.then(function(){$("#edit_setting_observation_type_field").modal("hide"),i(),t.notify("Operation Successful","Field updated succesfully","success"),e.tempHolder={}})},e.tempHolder={},e.manage=function(n,r){switch(n){case"edit":e.tempHolder.resourceId=r,e.tempHolder.FieldName=$(".btn-fields[data-option-id='"+r+"']").attr("data-option-name"),e.tempHolder.FieldDescription=$(".btn-fields[data-option-id='"+r+"']").attr("data-option-description"),$("#edit_setting_observation_type_field").modal("show");break;case"delete":var o="Delete Prompt",l="You are about to delete the Field titled "+$(".btn-fields[data-option-id='"+r+"']").attr("data-option-name")+". Do you want to continue? Please note that this action cannot be undone",s=!0,u=function(){var e=t.serverRequest("/nursing/observation-type-field/delete?"+t.serializeParams({resourceId:r}),"DELETE");e.then(function(){t.notify("Operation Successful","The selected field has been deleted successfully","success"),i()},function(e){t.errorHandler(e)})},a="warning",d="Delete";t.confirm(o,l,s,u,a,d);break;case"defaults":"undefined"!=typeof r&&(t.serverRequest("/nursing/observation-type-field-default/view?resourceId="+r,"GET").then(function(t){e.currentDefaultValues=t,e.currentDefaultValuesField=r},function(e){t.errorHandler(e)}),$("#field_defaults").modal("show"));break;case"dirtyValues":"undefined"!=typeof r&&(t.serverRequest("/nursing/observation-type-field-dirty-value/view?resourceId="+r,"GET").then(function(t){e.currentDirtyValues=t,e.currentDirtyValuesField=r},function(e){t.errorHandler(e)}),$("#field_dirty_values").modal("show"))}},e.saveNewDefaultValue=function(){var n={field:e.currentDefaultValuesField,value:e.newDefaultValue},i=t.serverRequest("/nursing/observation-type-field-default/new","POST",n);i.then(function(){t.notify("Operation Successful","New default value registered successfully","success"),e.manage("defaults",e.currentDefaultValuesField),e.newDefaultValue=""},function(e){t.errorHandler(e)})},e.deleteDefaultValue=function(n,i){t.serverRequest("/nursing/observation-type-field-default/delete?resourceId="+n,"DELETE").then(function(){e.currentDefaultValues.splice(i,1),t.alert("Operation successful","The delete request has been processed successfully","success","notify")},function(e){t.errorHandler(e)})},e.saveNewDirtyValue=function(){var n={field:e.currentDirtyValuesField,value:e.newDirtyValue,condition:e.newDirtyValueCondition},i=t.serverRequest("/nursing/observation-type-field-dirty-value/new","POST",n);i.then(function(){t.notify("Operation Successful","New dirty value registered successfully","success"),e.manage("dirtyValues",e.currentDirtyValuesField),e.newDirtyValue=""},function(e){t.errorHandler(e)})},e.deleteDirtyValue=function(n,i){t.serverRequest("/nursing/observation-type-field-dirty-value/delete?resourceId="+n,"DELETE").then(function(){e.currentDirtyValues.splice(i,1),t.alert("Operation successful","The delete request has been processed successfully","success","notify")},function(e){t.errorHandler(e)})}});