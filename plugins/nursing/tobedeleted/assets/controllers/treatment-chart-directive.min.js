angular.module("EmmetBlue").directive("ngTreatmentChart",function(){return{restrict:"AE",scope:{admissionId:"=admissionId",allowNew:"@allowNew"},templateUrl:"plugins/nursing/assets/includes/treatment-chart-template.html",controller:function(e,t){function n(){"function"==typeof e.dtInstance.reloadData&&e.dtInstance.reloadData()}e.treatmentChart={},e.dtInstance={},e.dtOptions=t.DT.optionsBuilder.fromFnPromise(function(){return t.serverRequest("/nursing/treatment-chart/view?resourceId="+e.admissionId,"GET")}).withPaginationType("full_numbers").withDisplayLength(10).withFixedHeader().withOption("createdRow",function(n){t.compile(angular.element(n).contents())(e)}).withOption("headerCallback",function(n){e.headerCompiled||(e.headerCompiled=!0,t.compile(angular.element(n).contents())(e))}),"true"==e.allowNew&&(e.dtOptions=e.dtOptions.withButtons([{text:'<i class="icon-file-plus"></i> New Item',action:function(){$("#new_item").modal("show")}}])),e.dtColumns=[t.DT.columnBuilder.newColumn("TreatmentChartID").withTitle("ID"),t.DT.columnBuilder.newColumn("Drug").withTitle("Drug"),t.DT.columnBuilder.newColumn("Dose").withTitle("Dose"),t.DT.columnBuilder.newColumn("Route").withTitle("Route"),t.DT.columnBuilder.newColumn("Time").withTitle("Time"),t.DT.columnBuilder.newColumn("Note").withTitle("Comment"),t.DT.columnBuilder.newColumn("Nurse").withTitle("Administered By")],e.$watch("admissionId",function(){n()}),e.saveChart=function(){var i=e.treatmentChart;i.nurse=t.userSession.getID(),i.admissionId=e.admissionId;var o=t.serverRequest("/nursing/treatment-chart/new","POST",i);o.then(function(){$("#new_item").modal("hide"),t.alert("Operation Successful","Treatment chart saved successfully","success"),n()},function(e){t.errorHandler(e)})}}}});