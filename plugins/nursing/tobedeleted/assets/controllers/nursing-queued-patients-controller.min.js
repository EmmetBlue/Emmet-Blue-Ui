angular.module("EmmetBlue").controller("nursingQueuedPatientsController",function(e,t,n){function o(e){viewCardButtonAction="manage('view',"+e.PatientID+")",closeButtonAction="manage('close',"+e.PatientID+")",observationButtonAction="manage('observation',"+e.PatientID+")";var t="data-option-id = '"+e.PatientID+"' data-patient-uuid = '"+e.PatientUUID+"'";return viewCard="<button class='btn btn-default' ng-click=\""+viewCardButtonAction+'">View Profile</button>',closeProfile="<button class='btn btn-default' ng-click=\""+closeButtonAction+'">Close</button>',observation="<button class='btn btn-default btn-queue' ng-click=\""+observationButtonAction+'"'+t+">Process Patient</button>","<div class='btn-group'>"+viewCard+observation+closeProfile+"</div>"}function i(){e.$broadcast("recountQueue"),t.dtInstance.reloadData()}function a(){n.serverRequest("/nursing/load-doctors/view-queue-count","GET").then(function(e){t.doctors=e},function(e){n.errorHandler(e)})}t.loadImage=n.loadImage,t.forwardEnabled=!1,t.dtInstance={},t.dtOptions=n.DT.optionsBuilder.fromFnPromise(function(){return n.serverRequest("/patients/patient/view-unlocked-profiles","GET")}).withPaginationType("full_numbers").withDisplayLength(10).withFixedHeader().withOption("createdRow",function(e){n.compile(angular.element(e).contents())(t)}).withOption("headerCallback",function(e){t.headerCompiled||(t.headerCompiled=!0,n.compile(angular.element(e).contents())(t))}),t.dtColumns=[n.DT.columnBuilder.newColumn(null).withTitle("S/N").renderWith(function(e,t,n,o){return o.row+1}),n.DT.columnBuilder.newColumn("PatientUUID").withTitle("Patient Number"),n.DT.columnBuilder.newColumn("PatientFullName").withTitle("Patient Name"),n.DT.columnBuilder.newColumn(null).withTitle("Profile Status").renderWith(function(){return"<span class='label label-success'>Unlocked</span>&nbsp;<span class='label label-info'>Unadmitted</span>"}),n.DT.columnBuilder.newColumn(null).withTitle("Action").renderWith(o).notSortable()],setInterval(function(){i()},5e3),t.manage=function(e,o){switch(e){case"view":n.serverRequest("/patients/patient/view?resourceId="+o,"GET").then(function(e){t.patientInfo=e._source,$("#patient-card").modal("show")},function(e){n.errorHandler(e)});break;case"close":var r={patient:o},l="Do you want to continue?",u="You are about to close this profile, please note that you will not be able to load this profile any longer until it has been reopened",s=!0,c=function(){n.serverRequest("/patients/patient/lock-profile","PUT",r).then(function(){n.notify("Operation Succesful","The selected profile has been closed successfully","success"),i()},function(e){n.errorHandler(e)})},d="info",f="Continue";n.confirm(l,u,s,c,d,f);break;case"observation":n.serverRequest("/patients/patient/view?resourceId="+o,"GET").then(function(e){t.patientInfo=e._source,t.forwardEnabled=!1,$("#observation").modal("show")},function(e){n.errorHandler(e)}),a()}},a(),t.selectedDoctor="",t.queuePatient=function(){var e={consultant:t.selectedDoctor,patient:t.patientInfo.patientid};n.serverRequest("/consultancy/patient-queue/new","POST",e).then(function(){n.serverRequest("/patients/patient/lock-profile","PUT",e).then(function(){n.notify("Operation Succesful","The selected patient has been processed successfully","success"),i()},function(e){n.errorHandler(e)}),$("#observation").modal("hide")},function(e){n.errorHandler(e)})},t.$on("observationComplete",function(){t.forwardEnabled=!0})});