function nursingPatientWorkspaceController(e,t,n){function r(){var e=n.serverRequest("/nursing/observation-type/view","GET");e.then(function(e){t.observationTypes=e},function(e){n.errorHandler(e)})}function o(e){n.serverRequest("/nursing/observation-type/view?resourceId="+e,"GET").then(function(e){t.currentObservationTypeName=e[0].ObservationTypeName},function(){}),n.serverRequest("/nursing/observation-type-field/view?resourceId="+e,"GET").then(function(e){t.observationTypeFields=e,setTimeout(function(){$(".autosuggest").each(function(){var e=$(this);e.typeahead({hint:!0,highlight:!0,minLength:1},{source:function(t,r){n.serverRequest("/nursing/observation-type-field-default/view?resourceId="+e.attr("data-id"),"GET").then(function(e){var t=[];angular.forEach(e,function(e){t.push(e.Value)}),t=$.map(t,function(e){return{value:e}}),r(t)},function(e){n.errorHandler(e)})}})})},2e3)},function(e){n.errorHandler(e)})}t.loadImage=n.loadImage,t.patientProfileLoaded=!1,t.patient={},t.currentObservationType=0,t.observationResult={},r(),t.daysSpent=function(e){var t=(new Date).toLocaleDateString();return n.dateDiff(e,t)},t.$watch("currentObservationType",function(e){"undefined"!=typeof e&&o(e)}),t.loadPatient=function(){var e=n.serverRequest("/nursing/ward-admission/view-admitted-patients?resourceId="+t.patientNumber,"GET");e.then(function(e){var r={query:e[0].AdmissionInfo.PatientUUID,size:1,from:0};t.admissionInfo=e[0],n.serverRequest("/patients/patient/search","POST",r).then(function(e){t.patient=e.hits.hits[0]._source,t.patientProfileLoaded=!0,t.loadRepositories(),i()},function(e){n.errorHandler(e)})},function(e){n.errorHandler(e)})};var i=function(){var e=n.serverRequest("/consultancy/consultation-sheet/view?resourceId="+t.admissionInfo.WardAdmissionID,"GET");e.then(function(e){t.consultationNotes=e},function(e){n.errorHandler(e)})};t.loadRepositories=function(){var e=n.serverRequest("/patients/patient-repository/view-by-patient?resourceId="+t.patient.patientid,"GET");e.then(function(e){t.patient.repositories=e},function(e){n.errorHandler(e)})},t.loadRepo=function(e){t.currentRepository=e,$("#repository-items").modal("show")},t.getFieldName=function(e){var t=$(".observationData[data-id='"+e+"']").attr("data-value-name");return t},t.submitLikeThat=function(){$("#dirtyValuesPresentModal").modal("hide"),t.process()},t.submitObservation=function(){var r=t.patient.patientid,o={},i=n.userSession.getID(),a=[];if($(".observationData").each(function(){o[$(this).attr("data-value-name")]=$(this).val(),""!=$(this).val()&&a.push({field:$(this).attr("data-id"),value:$(this).val()})}),angular.equals(t.observationResult,{}))n.alert("An error occurred","Please make sure you've filled in at least one field to continue","warning");else{var s=n.serverRequest("/nursing/observation-type-field-dirty-value/contains-dirt","POST",a);s.then(function(e){!angular.equals(e,{})&&e.conclusion?(t.dirtyValues=e,delete t.dirtyValues.conclusion,$("#dirtyValuesPresentModal").modal("show")):t.process()},function(e){console.log(e)})}t.process=function(){var a={patientId:r,observationType:t.currentObservationType,observationTypeName:t.currentObservationTypeName,observation:{"Primary Information":{"Observation Type":t.currentObservationType,"Carried Out By":i,"Date Of Observation":(new Date).toLocaleDateString()},Deduction:o},staffId:i};console.log(a),n.serverRequest("/nursing/observation/new","POST",a).then(function(r){n.notify("Operation Completed Successfully","Observation Published Successfuly","success"),t.observationResult={},t.currentRepository=r.repoId,e.$broadcast("observationComplete")},function(e){n.errorHandler(e)})}}}angular.module("EmmetBlue").directive("ngObservationForm",function(){return{restrict:"AE",scope:{patient:"=patient"},templateUrl:"plugins/nursing/assets/includes/observation-template.html",controller:function(e,t,n){nursingPatientWorkspaceController(e,t,n)}}}).controller("nursingPatientWorkspaceController",function(e,t,n){nursingPatientWorkspaceController(e,t,n)});