angular.module("EmmetBlue").controller("nursingPatientAdmissionController",function(e,t){function n(e){observationButtonAction="manage('process',"+e.PatientAdmissionID+")",viewButtonAction="manage('view',"+e.PatientAdmissionID+")";var t="data-option-id = '"+e.PatientAdmissionID+"' data-option-consultant = '"+e.Consultant+"'data-option-patient = '"+e.Patient+"'data-option-ward = '"+e.WardName+"'data-option-section = '"+e.WardSectionName+"'data-option-section-id = '"+e.Section+"'data-option-admission-date = '"+e.AdmissionDate+"'";return observation="<button class='btn btn-warning btn-admission-process' ng-if='!"+e.ReceivedInWard+"' ng-click=\""+observationButtonAction+'"'+t+">Process Patient</button>",view="<button class='btn btn-default btn-admission-process' ng-if='"+e.ReceivedInWard+"' ng-click=\""+viewButtonAction+'"'+t+">View Admission</button>","<div class='btn-group'>"+observation+view+"</div>"}function i(){var n=t.serverRequest("/nursing/ward/view","GET");n.then(function(t){e.wards=t},function(e){t.errorHandler(e)})}function a(){e.dtInstance.reloadData()}function o(n){t.serverRequest("/nursing/section-bed/view?resourceId="+n,"GET").then(function(t){e.beds=t},function(e){t.errorHandler(e)})}e.loadImage=t.loadImage,e.dtInstance={},e.dtOptions=t.DT.optionsBuilder.fromFnPromise(function(){return t.serverRequest("/consultancy/patient-admission/view-admitted-patients?resourceId="+e.currentWard,"GET")}).withPaginationType("full_numbers").withDisplayLength(10).withFixedHeader().withOption("createdRow",function(n){t.compile(angular.element(n).contents())(e)}).withOption("headerCallback",function(n){e.headerCompiled||(e.headerCompiled=!0,t.compile(angular.element(n).contents())(e))}),e.dtColumns=[t.DT.columnBuilder.newColumn(null).withTitle("S/N").renderWith(function(e,t,n,i){return i.row+1}),t.DT.columnBuilder.newColumn("WardDetails.WardAdmissionID").withTitle("Admission Number"),t.DT.columnBuilder.newColumn("Consultant").withTitle("Admitted By"),t.DT.columnBuilder.newColumn(null).withTitle("Patient Name").renderWith(function(t){var n=e.loadImage(t.PatientPicture),i='<div class="media-left"> <a href="#"> <img src="'+n+'" class="img-circle" alt=""> </a> </div> '+t.PatientFullName+' <span class="text-muted">'+t.PatientUUID+"</span>";return"<div class='media'>"+i+"</div>"}),t.DT.columnBuilder.newColumn("AdmissionDate").withTitle("Admission Date"),t.DT.columnBuilder.newColumn(null).withTitle("Ward").renderWith(function(e){var t=e.WardName+"<div class='clear'></div><span class='pull-right display-block'>";return t+="&nbsp;<span class='label label-info'>"+e.WardSectionName+"</span>",0==e.ReceivedInWard?t+="&nbsp;<span class='label label-danger'> Not admitted to ward yet</span>":1==e.ReceivedInWard&&(t+="&nbsp;<span class='label label-success'> Admitted to ward</span>"),t+"</span>"}),t.DT.columnBuilder.newColumn(null).withTitle("Action").renderWith(n).notSortable()],i(),e.manage=function(n,i){switch(n){case"process":e.admittedAlready=!1,t.serverRequest("/patients/patient/view?resourceId="+$(".btn-admission-process[data-option-id='"+i+"']").attr("data-option-patient"),"GET").then(function(t){e.patientInfo=t._source,e.showPatientInfo=!0,$elem=$(".btn-admission-process[data-option-id='"+i+"']"),e.admissionInfo={consultant:$elem.attr("data-option-consultant"),ward:$elem.attr("data-option-ward"),section:$elem.attr("data-option-section"),admissionDate:$elem.attr("data-option-admission-date")},e.currentAdmission=i,o($elem.attr("data-option-section-id")),$("#observation").modal("show")},function(e){t.errorHandler(e)});break;case"view":e.admittedAlready=!0,t.serverRequest("/patients/patient/view?resourceId="+$(".btn-admission-process[data-option-id='"+i+"']").attr("data-option-patient"),"GET").then(function(t){e.patientInfo=t._source,e.showPatientInfo=!0,$elem=$(".btn-admission-process[data-option-id='"+i+"']"),e.admissionInfo={consultant:$elem.attr("data-option-consultant"),ward:$elem.attr("data-option-ward"),section:$elem.attr("data-option-section"),admissionDate:$elem.attr("data-option-admission-date")},e.currentAdmission=i,$("#observation").modal("show")},function(e){t.errorHandler(e)})}},e.hold={},e.admitPatient=function(){if(angular.isDefined(e.hold.selectedBed)&&""!=e.hold.selectedBed){var n={bed:e.hold.selectedBed,admissionId:e.currentAdmission,processedBy:t.userSession.getID()};t.serverRequest("/nursing/ward-admission/new","POST",n).then(function(){a(),delete e.hold.selectedBed,$("#observation").modal("hide")},function(e){t.errorHandler(e)})}else t.alert("You've not selected a bed","Please a select a bed from the list to continue","warning")},e.$on("observationComplete",function(){e.forwardEnabled=!0}),e.$watch(function(){return e.currentWard},function(e){"undefined"!=typeof e&&a()})});