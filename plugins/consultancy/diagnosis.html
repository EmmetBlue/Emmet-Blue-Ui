<script src="assets/js/plugins/forms/selects/select2.min.js"></script>
<script src="assets/js/plugins/forms/tags/bootstrap-tagsinput.js"></script>
<script src="assets/js/plugins/forms/inputs/typeahead/typeahead.bundle.min.js"></script>
<script src="assets/js/core/app.js"></script>
<script>
	$('select.select').select2();
	$(function() {

	    // Initialize lightbox
	    $('[data-popup=lightbox]').fancybox({
	        padding: 3
	    });
	    
	});

	$('body').on('hidden.bs.modal', function () {
	    if($('.modal.in').length > 0)
	    {
	        $('body').addClass('modal-open');
	    }
	});
</script>
<div ng-controller="consultancyNewDiagnosisController">
	<div class="row mb-15">
		<div class="col-md-7 col-md-offset-3 valign-middle">
			<div class="form-group pb-10">
				<div class="col-lg-12">
					<div class="input-group">
						<input type="text" id="patient-patientSearchQuery" class="form-control patient-search" placeholder="enter patient number to begin" ng-model="patientSearchQuery"/>
						<span class="input-group-btn">
							<button class="btn btn-info" ng-click="patient.loadPatientProfile()">Go</button>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="panel panel-white zoomIn">
		<div class="panel-heading">
			<h6 class="panel-title" ng-hide="patient.isProfileReady"><span class="text-bold">Patient Diagnosis Wizard</h6>
			<h6 class="panel-title" ng-show="patient.isProfileReady"><span class="text-bold">New Diagnosis For:</span> {{patient.profile["first name"]}} {{patient.profile["last name"]}} </h6>
			<div class="heading-elements">
				<h6><span class="text-bold">Date:</span> {{globals.today()}} </h6>
	    	</div>
		</div>
		<div class="panel-body table-responsive">
			<div class="col-md-9">
				<div class="tabbable">
					<ul class="nav nav-tabs nav-tabs-bottom nav-justified">
						<li href="#history" data-toggle="tab" class="active"><a>History</a></li>
						<li href="#allergies" data-toggle="tab"><a>Allergies</a></li>
						<li href="#presenting-complaints" data-toggle="tab"><a>Chief Complaint</a></li>
						<li href="#examination" data-toggle="tab"><a>Examination</a></li>
						<li href="#investigation" data-toggle="tab"><a>Investigation</a></li>
						<li href="#diagnosis" data-toggle="tab"><a>Conclusion</a></li>
					</ul>

					<div class="tab-content">
						<div class="tab-pane active" id="history">
							<div class="col-md-3">
								<div class="sidebar sidebar-main sidebar-default" style="box-shadow: none; border-color: #F5F5F5; border-radius: 0px;">
									<div class="sidebar-content">
										<!-- Main navigation -->
										<div class="sidebar-category sidebar-category-visible">
											<div class="category-content no-padding">
												<ul class="navigation navigation-main navigation-accordion navigation-bordered">
													<!-- Main -->
													<li>
														<a href="#"><i class="icon-stack2"></i> <span>Profile</span></a>
													</li>
													<!-- <li>
														<a href="#"><i class="icon-stack2"></i> <span>Medical</span></a>
													</li>
													<li>
														<a href="#"><i class="icon-stack2"></i> <span>Family/Social</span></a>
													</li>
													<li>
														<a href="#"><i class="icon-stack2"></i> <span>Surgical</span></a>
													</li>
													<li>
														<a href="#"><i class="icon-stack2"></i> <span>Analysis</span></a>
													</li> -->
													<!-- /main -->
												</ul>
											</div>
										</div>
										<!-- /main navigation -->
									</div>
								</div>
							</div>
							<div class="col-md-9">
								<ng-patient-profile patient-info="patient.profile" ng-show="patient.isProfileReady"></ng-patient-profile>
							</div>
						</div>
						<div class="tab-pane" id="allergies">
							<div class="tabbable">
								<ul class="nav nav-tabs nav-justified">
									<li href="#allergy-list" data-toggle="tab" class="active"><a>Allergy List</a></li>
									<li href="#new-allergy" data-toggle="tab"><a>Register a new allergy</a></li>
								</ul>

								<div class="tab-content">
									<div class="tab-pane has-padding active" id="allergy-list">
										<div class="row">
											<div class="col-md-12" ng-repeat="allergy in patient.allergies">
												<div class="panel panel-body" style="box-shadow: none;">
													<div class="media">
														<div class="media-left">
															<a href="#"><i class="icon-file-text2 text-success-400 icon-2x no-edge-top mt-5"></i></a>
														</div>

														<div class="media-body">
															<h6 class="media-heading text-semibold"><strong><a href="#" class="text-default">{{allergy.AllergyTitle}}</a></strong></h6>
															<p>{{allergy.AllergyDescription}}</p>
															<div class="row">	
																<div class="col-md-6">
																	<h5 class="text-info"><small>Symptoms</small></h5>
																	<ol>
																		<li ng-repeat="symptom in allergy.symptoms">{{symptom.Symptom}}</li>
																	</ol>
																</div>
																<div class="col-md-6">
																	<h5 class="text-info"><small>Triggers</small></h5>
																	<ol>
																		<li ng-repeat="trigger in allergy.triggers">{{trigger.TriggerTitle}}</li>
																	</ol>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>

									<div class="tab-pane has-padding" id="new-allergy">
										<div class="row">
											<div class="content-group col-md-6">
												<label class="control-label">Allergy Title</label>
												<input class="form-control" ng-model="allergies.newAllergy.title"/>
											</div>
											<div class="content-group col-md-6">
												<label class="control-label">Allergy Severity</label>
												<select class="select" ng-model="allergies.newAllergy.severity">
													<option value=""></option>
												</select>
											</div>
											<div class="content-group col-md-12">
												<label class="control-label">Allergy Type</label>
												<select class="select" ng-model="allergies.newAllergy.type">
													<option value="{{type.AllergyID}}" ng-repeat="type in allergies.allergyTypes">
														{{type.AllergyName}}
													</option>
												</select>
											</div>
											<div class="content-group col-md-12">
												<label class="control-label">Allergy Trigger(s)</label>
												<select class="select" multiple="" ng-model="allergies.newAllergy.triggers">
													<option value="{{trigger.TriggerName}}" ng-repeat="trigger in allergies.allergyTypeTriggers">
														{{trigger.TriggerName}}
													</option>
												</select>
											</div>
											<div class="content-group col-md-12">
												<label class="control-label">Allergy Symptom(s)</label>
												<select class="tagsinput-typeahead" multiple="" data-role="tagsinput" ng-model="allergies.newAllergy.symptoms">
												</select>
											</div>
											<div class="content-group col-md-12">
												<label class="control-label">Note</label>
												<textarea class="form-control" ng-model="allergies.newAllergy.description"></textarea>
											</div>
											<div class="content-group col-md-12">
												<button class="btn btn-info pull-right col-md-3" ng-click="allergies.saveNewAllergy()">Save</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane" id="presenting-complaints">
							<div class="col-md-7 col-md-offset-3 mb-15">
								<div class="input-group">
									<input id="presentingComplaints-symptomSearchQuery" type="text" class="form-control symptom-search" placeholder="enter symptom to search" ng-model="presentingComplaints.symptomSearchQuery"/>
									<span class="input-group-btn">
										<button class="btn btn-danger" ng-click="presentingComplaints.performSymptomSearch()"> <i class="icon-search4"></i> search</button>
									</span>
								</div>
							</div>
							<div class="row">
								<div class="col-md-5" style="border-right: 1px solid #F5F5F5;">
									<div class="row">
										<div class="col-lg-12">
											<ul class="media-list search-results-list content-group" ng-repeat="symptom in presentingComplaints.searchedSymptoms">
						                    	<li class="media">
						                    		<div class="media-body">
							                    		<h6 class="media-heading"><strong><a href="#" ng-click="presentingComplaints.addToList(symptom['_source'].name)">{{symptom["_source"].name}}</a></strong></h6>
							                    		<ul class="list-inline list-inline-separate text-muted">
							                    			<li>Parent: <a href="#" class="text-success">{{presentingComplaints.loadSymptom(symptom["_source"].parent_id).name}}</a></li>
							                    		</ul>

							                    		<div class="website-search-results mt-10">
								                    		<div class="row">
								                    			<div class="content-group">
								                    				<div class="content-group col-md-6" ng-repeat="child in symptom['_source'].children">
								                    					<div class="media-body">
																			<h6 class="media-heading"><a href="#" ng-click="presentingComplaints.addToList(presentingComplaints.loadSymptom(child.id).name)">{{presentingComplaints.loadSymptom(child.id).name}}</a></h6>
																			<ul class="list-inline list-inline-separate text-muted">
												                    			<li>Parent Relation: <a href="#" class="text-success">{{presentingComplaints.loadSymptom(child.id).parent_relation}}</a></li>
												                    		</ul>
																		</div>
																	</div>
								                    			</div>
								                    		</div>
							                    		</div>
						                    		</div>
						                    	</li>
						                    </ul>
					                    </div>
									</div>
								</div>

								<div class="col-md-7">
									<div class="row pl-5 pr-5">
										<div class="panel-group panel-group-control panel-group-control-left">
											<div ng-repeat="complaint in presentingComplaints.complaints" class="panel" style="box-shadow: none; border-top-right-radius: 0px; border-top-left-radius: 0px; border-color: #F5F5F5">
												<div class="panel-heading" class="collapsed cursor-pointer" data-toggle="collapse" href="#complaint-{{$index+1}}">
													<h6 class="panel-title">
														<span class="cursor-pointer">
															{{complaint.title}}
														</span>
													</h6>
												</div>

												<div id="complaint-{{$index+1}}" class="panel-collapse collapse">
													<div class="panel-body">
														<div class="content-group col-md-12">
															<textarea class="form-control" ng-model="complaint.description"></textarea>
														</div>
														<div class="content-group">
															<h6 class="text-muted col-md-3">Characteristics:</h6>
															<span class="col-md-9">
																<select class="select" ng-model="complaint.characteristics">
																	<option value="severe">severe</option>
																	<option value="acute">acute</option>
																	<option value="numb">numb</option>
																</select>
															</span>
														</div>
													</div>

													<div class="panel-footer panel-footer-transparent">
														<button class="btn btn-link pull-right text-danger" ng-click="presentingComplaints.removeFromList($index)"><i class="icon-bin"></i> Remove</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane" id="examination">
							<div class="tabbable">
								<ul class="nav nav-tabs nav-tabs-solid nav-justified">
									<li href="#exam-{{$index+1}}" data-toggle="tab" ng-repeat="type in examination.examinationTypes"><a>{{type.ExamTypeTitle}}</a></li>
								</ul>

								<div class="tab-content">
									<div class="tab-pane" id="exam-{{$index+1}}" ng-repeat="type in examination.examinationTypes">
										<div class="row">
											<div class="form-group col-md-12" ng-repeat="option in type.options">
												<label class="control-label">
													<input type="checkbox" ng-model="option.selected"/>
													{{option.OptionTitle}}
												</label>
												<textarea class="form-control" ng-model="option.deductions"></textarea>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane" id="investigation">
							<div class="tabbable">
								<ul class="nav nav-tabs nav-tabs-solid nav-justified">
									<li href="#lab" data-toggle="tab" class="active"><a>Laboratory</a></li>
									<li href="#radiology" data-toggle="tab"><a>Radiology</a></li>
								</ul>

								<div class="tab-content">
									<div class="tab-pane active" id="lab">
										<div class="col-md-7 col-md-offset-3 mb-15">
											<div class="input-group">
												<input id="labTests-testSearchQuery" type="text" class="form-control lab-tests-search" placeholder="enter lab test to search" ng-model="labTests.testSearchQuery"/>
												<span class="input-group-btn">
													<button class="btn btn-danger" ng-click="labTests.performLabTestSearch()"> <i class="icon-search4"></i> search</button>
												</span>
											</div>
										</div>
										<div class="row">
											<div class="col-md-5" style="border-right: 1px solid #F5F5F5;">
												<div class="row">
													<div class="col-lg-12">
														<ul class="media-list search-results-list content-group" ng-repeat="test in labTests.searchedTests">
									                    	<li class="media">
									                    		<div class="media-body">
										                    		<h6 class="media-heading"><strong><a href="#" ng-click="labTests.addToLabList(test['_source'].name)">{{test["_source"].name}}</a></strong></h6>
										                    		<ul class="list-inline list-inline-separate text-muted">
										                    			<li>Category: <a href="#" class="text-success">{{test["_source"].category}}</a></li>
										                    		</ul>
										                    		<div class="website-search-results mt-10">
											                    		<div class="row">
											                    			<div class="content-group">
											                    				<div class="content-group col-md-6" ng-repeat="result in test['_source'].results">
											                    					<div class="media-body">
																						<ul class="list-inline list-inline-separate text-muted">
															                    			<li>value: <a href="#" class="text-success">{{result.type}}</a></li>
															                    		</ul>
																					</div>
																				</div>
											                    			</div>
											                    		</div>
										                    		</div>
									                    		</div>
									                    	</li>
									                    </ul>
								                    </div>
												</div>
											</div>

											<div class="col-md-7">
												<div class="row pl-5 pr-5">
													<div class="panel-group panel-group-control panel-group-control-left">
														<div ng-repeat="investigation in labTests.investigations.lab" class="panel" style="box-shadow: none; border-top-right-radius: 0px; border-top-left-radius: 0px; border-color: #F5F5F5">
															<div class="panel-heading">
																<h6 class="panel-title">
																	<a class="collapsed" data-toggle="collapse" href="#investigation-lab-{{$index+1}}">
																		{{investigation.title}}
																	</a>
																</h6>
															</div>

															<div id="investigation-lab-{{$index+1}}" class="panel-collapse collapse">
																<div class="panel-body">
																	<div class="content-group col-md-12">
																		<textarea class="form-control" ng-model="investigation.description"></textarea>
																	</div>
																</div>

																<div class="panel-footer panel-footer-transparent">
																	<button class="btn btn-link pull-right text-danger" ng-click="labTests.removeFromLabList($index)"><i class="icon-bin"></i> Remove</button>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>	
									</div>
									<div class="tab-pane" id="radiology">
										<div class="row">
											<div class="col-md-5" style="border-right: 1px solid #F5F5F5;">
												<div class="row">
													<div class="col-lg-12">
														<ul class="media-list search-results-list content-group" ng-repeat="test in labTests.imagingTests">
									                    	<li class="media">
									                    		<div class="media-body">
										                    		<h6 class="media-heading"><strong><a href="#" ng-click="labTests.addToImagingList(test.MedicalImagingName)">{{test.MedicalImagingName}}</a></strong></h6>
									                    		</div>
									                    		<ul class="list-inline list-inline-separate text-muted">
									                    			<li>{{test.MedicalImagingDescription}}</li>
									                    		</ul>
									                    	</li>
									                    </ul>
								                    </div>
												</div>
											</div>

											<div class="col-md-7">
												<div class="row pl-5 pr-5">
													<div class="panel-group panel-group-control panel-group-control-left">
														<div ng-repeat="investigation in labTests.investigations.imaging" class="panel" style="box-shadow: none; border-top-right-radius: 0px; border-top-left-radius: 0px; border-color: #F5F5F5">
															<div class="panel-heading">
																<h6 class="panel-title">
																	<a class="collapsed" data-toggle="collapse" href="#investigation-imaging-{{$index+1}}">
																		{{investigation.title}}
																	</a>
																</h6>
															</div>

															<div id="investigation-imaging-{{$index+1}}" class="panel-collapse collapse">
																<div class="panel-body">
																	<div class="content-group col-md-12">
																		<textarea class="form-control" ng-model="investigation.description"></textarea>
																	</div>
																</div>

																<div class="panel-footer panel-footer-transparent">
																	<button class="btn btn-link pull-right text-danger" ng-click="labTests.removeFromImagingList($index)"><i class="icon-bin"></i> Remove</button>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>	
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane" id="diagnosis">
							<div class="row">
								<div class="col-md-7" style="border-right: 1px solid #F5F5F5;">
									<div class="row">
										<div class="col-lg-12">
											<h6 class="text-center text-info" style="text-decoration: underline;">Diagnosis</h6>
											<div class="content-group">
												<input class="form-control" placeholder="diagnosis" ng-model="conclusion.diagnosis.title"/>
											</div>
											<div class="content-group">
												<textarea class="form-control" style="height: 400px; border: 0px; border-left: 1px solid #F5F5F5" ng-model="conclusion.diagnosis.description"></textarea>
											</div>
					                    </div>
									</div>
								</div>

								<div class="col-md-5">
									<div class="row">
										<div class="col-lg-12">
											<h6 class="text-center text-info" style="text-decoration: underline;">Prescription</h6>
											<div class="content-group">
												<div class="input-group">
													<input class="form-control drug-search" placeholder="enter prescription item here" id="conclusion-drug"/>
													<span class="input-group-btn">
														<button class="btn" ng-click="conclusion.searchDrug()" data-toggle="modal" data-target="#modal-drugs">add</button>
													</span>
												</div>
											</div>
											<div class="content-group">
												<div class="table-responsive">
													<table class="table table-bordered">
														<tbody>
															<tr class="active">
																<th colspan="3">Prescribed Items</th>
															</tr>
															<tr ng-repeat="prescription in conclusion.prescriptionList">
																<td>{{$index + 1}}</td>
																<td>{{prescription.item}}</td>
																<td class="text-danger">remove</td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
					                    </div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-3" style="border: 1px solid #F5F5F5; border-bottom: 0px; height: 2000px;">
				<div class="row">
					<div class="col-md-5">
						<h5 class="text-center text-primary"><small>Summary</small></h5>
					</div>
					<div class="col-md-7 pt-10">
						<button class="btn btn-sm btn-link text-info" ng-click="globals.save()"><i class="fa fa-save"></i> Save</button>
						<button class="btn btn-sm btn-link text-success" ng-click="globals.submit()"><i class="fa fa-code-fork"></i> Submit</button>
					</div>
				</div>
				<div class="table-responsive">
					<table class="table table-bordered">
						<tbody>
							<tr class="danger" ng-show="presentingComplaints.complaints.length > 0">
								<th colspan="3">Complaints</th>
							</tr>
							<tr ng-repeat="complaint in presentingComplaints.complaints">
								<td>{{$index + 1}}</td>
								<td>{{complaint.title}}</td>
							</tr>
							<tr class="danger" ng-show="labTests.investigations.lab.length > 0 || labTests.investigations.imaging.length > 0">
								<th colspan="3">Investigations</th>
							</tr>
							<tr class="active" ng-show="labTests.investigations.lab.length > 0">
								<th colspan="1">Laboratory</th>
							</tr>
							<tr ng-repeat="investigation in labTests.investigations.lab">
								<td>{{$index + 1}}</td>
								<td>{{investigation.title}}</td>
							</tr>
							<tr class="active" ng-show="labTests.investigations.imaging.length > 0">
								<th colspan="1">Radiology</th>
							</tr>
							<tr ng-repeat="investigation in labTests.investigations.imaging">
								<td>{{$index + 1}}</td>
								<td>{{investigation.title}}</td>
							</tr>
							<tr class="danger" ng-show="conclusion.prescriptionList.length > 0">
								<th colspan="3">Prescription</th>
							</tr>
							<tr ng-repeat="prescription in conclusion.prescriptionList">
								<td>{{$index + 1}}</td>
								<td>{{prescription.item}}</td>
							</tr>
							<tr class="danger" ng-show="patient.allergies.length > 0">
								<th colspan="3">Allergies</th>
							</tr>
							<tr ng-repeat="allergy in patient.allergies">
								<td>{{$index + 1}}</td>
								<td>{{allergy.AllergyTitle}}</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<div>
		<div id="modal-drugs" class="modal fade">
			<div class="modal-dialog modal-xs">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h5 class="modal-title">Search for: <strong><a data-dismiss="modal" ng-click="conclusion.addPrescriptionToList(conclusion.searchDrugGroups.name)">{{conclusion.searchDrugGroups.name}}</a></strong></h5>
					</div>

					<div class="modal-body">
						<div class="content-group">
							<input class="form-control" placeholder="filter" ng-model="conclusion.searchedDrugFilter"/>
						</div>
						<span ng-repeat="drug in conclusion.searchDrugGroups.conceptGroup">
							<span ng-repeat="item in drug.conceptProperties | filter:conclusion.searchedDrugFilter">
								<div class="checkbox checkbox-right">
									<label>
										<input type="checkbox" value="{{item.name}}" ng-model="item.selected" name="selectedDrugs[]">
										<strong><a href="#">{{item.name}}</a></strong>
										<p><a href="#">{{item.synonym}}</a></p>
									</label>
								</div>
								<hr>
							</span>
						</span>
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" ng-click="conclusion.addDrugsToPrescriptionToList()">Continue</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>