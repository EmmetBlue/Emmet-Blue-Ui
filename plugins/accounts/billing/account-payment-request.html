<div id="account_payment_request" ng-controller="accountPaymentRequestController">
	<div class="panel panel-white zoomIn" >
		<div class="panel-heading">
			<h6 class="panel-title">Payment Request Management</h6>
			<div class="heading-elements">
				<ul class="icons-list">
	        		<li><a data-action="reload"></a></li>
	        	</ul>
	    	</div>
		</div>

		<div class="panel-body">
			<div class="table-responsive col-md-12">
				<table datatable="" dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstance" class="table table-condensed table-striped table-hover">

				</table>
			</div>
		</div>
	</div>
<!-- new payment request modal -->
	<div id="new_account_payment_request" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header bg-warning">
					<div class="modal-title">
						New Payment Request
					</div>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body">
					<div class="tab-pane active" id="payment-request-new">
						<div class="form-group">
							<div class="input-group">
								<input class="form-control input-lg" placeholder="Enter a patients number or name here to search" type="search" data-popup="tooltip" data-trigger="focus" title="Click the Advanced link below for more search options" ng-model="search.query"/>
								<span class="input-group-btn">
									<button class="btn btn-warning btn-lg" type="button" ng-click="search(true)"> <i class="icon-search4"></i></button>
								</span>
							</div>
						</div>
						<div ng-show="requestForm.showSearchResult">
							<ul class="media-list overflow-auto" style="max-height: 400px;">
								<li class="media-header">Found {{searched.totalPageCount}} profiles matching search query</li>

								<li class="media btn col-md-4" ng-repeat="patient in searched.patients" ng-click="showRequestForm(patient['_source'])">
									<div class="media-left media-middle">
										<a href="#">
											<img ng-src="{{loadImage(patient['_source'].patientpicture)}}" class="img-circle" alt="">
										</a>
									</div>

									<div class="media-body text-left">
										<div class="media-heading text-semibold">{{patient["_source"].patientfullname}}</div>
										<span class="text-muted">{{patient["_source"].patienttypename}}</span>
									</div>
								</li>
							</ul>
						</div>

						<div ng-show="!requestForm.showSearchResult">
							<!-- {{requestForm.currentPatientProfile}} -->
							<div class="row">
								<h1 class="text-center text-black">{{requestForm.currentPatientProfile.patientfullname}}</h1>
								<div class="form-group col-md-6">
									<select class="select" ng-model="paymentRequestItem.item">
										<optgroup label="{{key}}" ng-repeat="(key, item) in requestItems">
											<option ng-repeat="value in item" value="{{value}}">{{value.BillingTypeItemName}}</option>
										</optgroup>
									</select>
								</div>
								<div class="input-group col-md-6">
									<input type="number" placeholder="Item Quantity. Defaults to 1" class="form-control col-md-7" ng-model="paymentRequestItem.quantity"/>
									<span class="input-group-btn">
										<button class="btn btn-default btn-success" ng-click="addPaymentRequestItemToList()">add</button>
									</span>
								</div>
								<div class="col-md-12 table-responsive">
									<table class="table table-condensed hover">
										<thead>
											<tr class="warning">
												<th>S/N</th>
												<th>Item</th>
												<th>Quantity</th>
												<th>Action</th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat="item in paymentRequestItems">
												<td>{{$index + 1}}</td>
												<td>{{item._item.BillingTypeItemName}}</td>
												<td>{{item.quantity}}</td>
												<td><a class="btn btn-link text-danger" href="#"><i class="icon-bin"></i> Remove</a></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<div class="row mt-30">	
							<button type="button" class="btn btn-warning pull-right" ng-show="!requestForm.showSearchResult" ng-click="createRequest()">
								<i class="icon-mail"></i> Create payment request
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- make payment modal or process payment modal -->
	<div id="request_payment_bill" class="modal fade">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header bg-warning">
					<div class="modal-title">Process Payment Request</div>
					<button class="close" data-dismiss="modal">&times; close</button>
				</div>
				<div class="modal-body">
					<div class="col-md-6">
						
						<legend class="text-semibold">Request Details</legend>
		                <p>Request Number: {{temp.requestNumber}}</p>
		                <p>Patient ID: {{temp.patientUUID}}</p>
		                <p>Patient Name: {{temp.patientFullName}}</p>
		                <p>Patient Type: {{temp.patientCategoryName}}, {{temp.patientTypeName}}</p>
					</div>
					<div class="col-md-6">
						<legend class="text-semibold">
							Request Status:
							<span class='badge badge-danger badge-lg' ng-if="temp.fulfillmentStatus == '0'">Unfulfilled</span>
		                	<span ng-if="temp.fulfillmentStatus == '1'">
		                		<span class='badge badge-success badge-lg'>Fulfilled</span>
		                		<span> Date Processed: <span class="badge badge-info badge-lg">{{temp.fulfilledDate}}</span></span>
		                	</span>
						</legend>
		                <p>Requesting Staff ID: {{temp.staffUUID}}</p>
		                <p>Department: {{temp.deptName}}, Unit: {{temp.subDeptName}}</p>
		                <p>Request Date: {{temp.requestDate}}</p>
		                <p>Fulfilled By: {{temp.fulfilledBy}}</p>
					</div>
					<div class="col-md-12">
						<div class="table-responsive">
						<table class="table table-responsive table-condensed table-bordered">
							<thead class="border-solid">
								<tr>
									<th>S/N</th>
									<th>Item Code</th>
									<th>Item</th>
									<th>Quantity</th>
									<th>Rate</th>
									<th>Price (<span ng-currency ng-currency-symbol="naira"></span>)</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="bills in itemsList">
									<th>{{$index + 1}}</th>
									<th>{{bills.ItemID}}</th>
									<th>{{bills.BillingTypeItemName}}</th>
									<th>{{bills.ItemQuantity}}</th>
									<th>{{bills.rateIdentifier}}</th>
									<th ng-model="itemAmount">{{bills.totalPrice}}</th>
									<th>
										<span class="button-group">
											<a href="btn btn-default" ng-click="removeFromItemList($index, item)"><i class="icon-bin"></i> remove item</a>
										</span>
									</th>
								</tr>	
							</tbody>
							<tfoot>
								<tr class="warning">
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th>Total</th>
									<th><span ng-currency ng-currency-symbol="naira"></span> {{itemsList.globalTotal}}</th>
								</tr>
							</tfoot>
						</table>
					</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-default" data-dismiss="modal">Close</button>
					<button ng-if="temp.fulfillmentStatus == '0'" class="btn btn-default" ng-click="makePayment()">Accept Payment</button>
				</div>
			</div>
		</div>
	</div>	

	<!-- verify Payment modal -->
	<div id="verify_payment" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div class="modal-title">Verify Payment Request</div>
					<button class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<div class="input-group">
							<input class="form-control input-lg" placeholder="Enter request number" type="input" ng-model="paymentRequestNumber"/>
							<span class="input-group-btn">
								<button class="btn btn-warning btn-lg" type="button" ng-click="verifyPayment(paymentRequestNumber)"> <i class="icon-file"></i> verify</button>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>